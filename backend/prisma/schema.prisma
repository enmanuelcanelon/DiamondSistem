// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model vendedores {
  id                   Int       @id @default(autoincrement())
  nombre_completo      String    @db.VarChar(255)
  codigo_vendedor      String    @unique @db.VarChar(50)
  email                String    @unique @db.VarChar(255)
  telefono             String?   @db.VarChar(20)
  password_hash        String    @db.VarChar(255)
  comision_porcentaje  Decimal   @default(10.00) @db.Decimal(5, 2)
  total_ventas         Decimal   @default(0.00) @db.Decimal(10, 2)
  total_comisiones     Decimal   @default(0.00) @db.Decimal(10, 2)
  activo               Boolean   @default(true)
  fecha_registro       DateTime  @default(now())
  fecha_actualizacion  DateTime  @default(now())

  clientes             clientes[]
  ofertas              ofertas[]
  contratos            contratos[]
  pagos                pagos[]
  solicitudes_cliente  solicitudes_cliente[]
  historial_cambios_precios historial_cambios_precios[]
  versiones_contratos_pdf versiones_contratos_pdf[]
}

model clientes {
  id                  Int       @id @default(autoincrement())
  nombre_completo     String    @db.VarChar(255)
  email               String    @db.VarChar(255)
  telefono            String    @db.VarChar(20)
  direccion           String?   @db.Text
  como_nos_conocio    String?   @db.VarChar(255)
  tipo_evento         String?   @db.VarChar(100)
  vendedor_id         Int?
  fecha_registro      DateTime  @default(now())
  fecha_actualizacion DateTime  @default(now())

  vendedores          vendedores? @relation(fields: [vendedor_id], references: [id])
  ofertas             ofertas[]
  contratos           contratos[]
  eventos             eventos[]
  solicitudes_cliente solicitudes_cliente[]
}

model temporadas {
  id              Int       @id @default(autoincrement())
  nombre          String    @db.VarChar(50)
  meses           String    @db.VarChar(255)
  ajuste_precio   Decimal   @db.Decimal(10, 2)
  descripcion     String?   @db.Text
  activo          Boolean   @default(true)

  ofertas         ofertas[]
}

model paquetes {
  id                   Int       @id @default(autoincrement())
  nombre               String    @db.VarChar(100)
  precio_base          Decimal   @db.Decimal(10, 2)
  duracion_horas       Int
  invitados_minimo     Int?
  dias_disponibles     String?   @db.VarChar(100)
  horario_inicio       DateTime? @default(dbgenerated("'10:00:00'::time without time zone")) @db.Time(6)
  horario_fin_base     DateTime? @default(dbgenerated("'01:00:00'::time without time zone")) @db.Time(6)
  horario_fin_maximo   DateTime? @default(dbgenerated("'02:00:00'::time without time zone")) @db.Time(6)
  descripcion          String?   @db.Text
  es_personalizable    Boolean   @default(false)
  activo               Boolean   @default(true)
  fecha_creacion       DateTime  @default(now())

  paquetes_servicios   paquetes_servicios[]
  ofertas              ofertas[]
  contratos            contratos[]
}

model servicios {
  id                              Int       @id @default(autoincrement())
  nombre                          String    @db.VarChar(255)
  descripcion                     String?   @db.Text
  precio_base                     Decimal   @db.Decimal(10, 2)
  tipo_cobro                      String    @default("fijo") @db.VarChar(50)
  categoria                       String?   @db.VarChar(100)
  requiere_seleccion              Boolean   @default(false)
  opciones_disponibles            String?   @db.Text
  activo                          Boolean   @default(true)
  fecha_creacion                  DateTime  @default(now())

  paquetes_servicios              paquetes_servicios[]
  ofertas_servicios_adicionales   ofertas_servicios_adicionales[]
  contratos_servicios             contratos_servicios[]
  solicitudes_cliente             solicitudes_cliente[]
}

model paquetes_servicios {
  id               Int       @id @default(autoincrement())
  paquete_id       Int
  servicio_id      Int
  cantidad         Int       @default(1)
  incluido_gratis  Boolean   @default(true)
  notas            String?   @db.Text

  paquetes         paquetes  @relation(fields: [paquete_id], references: [id], onDelete: Cascade)
  servicios        servicios @relation(fields: [servicio_id], references: [id], onDelete: Cascade)

  @@unique([paquete_id, servicio_id])
}

model ofertas {
  id                              Int       @id @default(autoincrement())
  codigo_oferta                   String    @unique @db.VarChar(50)
  cliente_id                      Int?
  vendedor_id                     Int?
  paquete_id                      Int?
  fecha_evento                    DateTime  @db.Date
  hora_inicio                     DateTime  @db.Time(6)
  hora_fin                        DateTime  @db.Time(6)
  cantidad_invitados              Int
  lugar_evento                    String?   @db.VarChar(255)
  temporada_id                    Int?
  precio_paquete_base             Decimal   @db.Decimal(10, 2)
  ajuste_temporada                Decimal   @default(0.00) @db.Decimal(10, 2)
  subtotal_servicios              Decimal   @default(0.00) @db.Decimal(10, 2)
  subtotal                        Decimal   @db.Decimal(10, 2)
  descuento                       Decimal   @default(0.00) @db.Decimal(10, 2)
  impuesto_porcentaje             Decimal   @default(7.00) @db.Decimal(5, 2)
  impuesto_monto                  Decimal   @db.Decimal(10, 2)
  tarifa_servicio_porcentaje      Decimal   @default(18.00) @db.Decimal(5, 2)
  tarifa_servicio_monto           Decimal   @db.Decimal(10, 2)
  total_final                     Decimal   @db.Decimal(10, 2)
  estado                          String    @default("pendiente") @db.VarChar(50)
  motivo_rechazo                  String?   @db.Text
  notas_vendedor                  String?   @db.Text
  fecha_creacion                  DateTime  @default(now())
  fecha_actualizacion             DateTime  @default(now())
  fecha_respuesta                 DateTime?

  clientes                        clientes? @relation(fields: [cliente_id], references: [id])
  vendedores                      vendedores? @relation(fields: [vendedor_id], references: [id])
  paquetes                        paquetes? @relation(fields: [paquete_id], references: [id])
  temporadas                      temporadas? @relation(fields: [temporada_id], references: [id])
  ofertas_servicios_adicionales   ofertas_servicios_adicionales[]
  contratos                       contratos[]
  historial_cambios_precios       historial_cambios_precios[]
}

model ofertas_servicios_adicionales {
  id                Int       @id @default(autoincrement())
  oferta_id         Int
  servicio_id       Int?
  cantidad          Int       @default(1)
  precio_unitario   Decimal   @db.Decimal(10, 2)
  precio_original   Decimal   @db.Decimal(10, 2)
  subtotal          Decimal   @db.Decimal(10, 2)
  notas             String?   @db.Text
  fecha_agregado    DateTime  @default(now())

  ofertas           ofertas   @relation(fields: [oferta_id], references: [id], onDelete: Cascade)
  servicios         servicios? @relation(fields: [servicio_id], references: [id])
}

model contratos {
  id                      Int       @id @default(autoincrement())
  codigo_contrato         String    @unique @db.VarChar(50)
  oferta_id               Int?
  cliente_id              Int?
  vendedor_id             Int?
  paquete_id              Int?
  fecha_evento            DateTime  @db.Date
  hora_inicio             DateTime  @db.Time(6)
  hora_fin                DateTime  @db.Time(6)
  cantidad_invitados      Int
  total_contrato          Decimal   @db.Decimal(10, 2)
  tipo_pago               String    @db.VarChar(50)
  meses_financiamiento    Int       @default(1)
  pago_mensual            Decimal?  @db.Decimal(10, 2)
  plan_pagos              Json?
  total_pagado            Decimal   @default(0.00) @db.Decimal(10, 2)
  saldo_pendiente         Decimal   @db.Decimal(10, 2)
  estado_pago             String    @default("pendiente") @db.VarChar(50)
  codigo_acceso_cliente   String    @unique @db.VarChar(100)
  estado                  String    @default("activo") @db.VarChar(50)
  fecha_firma             DateTime  @default(now())
  fecha_actualizacion     DateTime  @default(now())
  terminos_aceptados      Boolean   @default(true)
  comision_calculada      Decimal?  @db.Decimal(10, 2)
  comision_pagada         Boolean   @default(false)

  ofertas                 ofertas?  @relation(fields: [oferta_id], references: [id])
  clientes                clientes? @relation(fields: [cliente_id], references: [id])
  vendedores              vendedores? @relation(fields: [vendedor_id], references: [id])
  paquetes                paquetes? @relation(fields: [paquete_id], references: [id])
  contratos_servicios     contratos_servicios[]
  pagos                   pagos[]
  eventos                 eventos?
  solicitudes_cliente     solicitudes_cliente[]
  mensajes                mensajes[]
  historial_cambios_precios historial_cambios_precios[]
  versiones_contratos_pdf versiones_contratos_pdf[]
  mesas                   mesas[]
  invitados               invitados[]
  playlist_canciones      playlist_canciones[]
  ajustes_evento          ajustes_evento?
}

model contratos_servicios {
  id                    Int       @id @default(autoincrement())
  contrato_id           Int
  servicio_id           Int?
  cantidad              Int       @default(1)
  precio_unitario       Decimal   @db.Decimal(10, 2)
  subtotal              Decimal   @db.Decimal(10, 2)
  incluido_en_paquete   Boolean   @default(false)
  fecha_agregado        DateTime  @default(now())

  contratos             contratos @relation(fields: [contrato_id], references: [id], onDelete: Cascade)
  servicios             servicios? @relation(fields: [servicio_id], references: [id])
}

model pagos {
  id                  Int       @id @default(autoincrement())
  contrato_id         Int?
  monto               Decimal   @db.Decimal(10, 2)
  metodo_pago         String?   @db.VarChar(50)
  tipo_tarjeta        String?   @db.VarChar(50)
  recargo_tarjeta     Decimal   @default(0.00) @db.Decimal(10, 2)
  monto_total         Decimal   @db.Decimal(10, 2)
  numero_referencia   String?   @db.VarChar(100)
  estado              String    @default("completado") @db.VarChar(50)
  notas               String?   @db.Text
  fecha_pago          DateTime  @default(now())
  registrado_por      Int?

  contratos           contratos? @relation(fields: [contrato_id], references: [id])
  vendedores          vendedores? @relation(fields: [registrado_por], references: [id])
}

model eventos {
  id                              Int       @id @default(autoincrement())
  contrato_id                     Int       @unique
  cliente_id                      Int?
  nombre_evento                   String    @db.VarChar(255)
  fecha_evento                    DateTime  @db.Date
  hora_inicio                     DateTime  @db.Time(6)
  hora_fin                        DateTime  @db.Time(6)
  cantidad_invitados_confirmados  Int?
  estado                          String    @default("en_proceso") @db.VarChar(50)
  detalles_comida                 String?   @db.Text
  detalles_bebidas                String?   @db.Text
  detalles_decoracion             String?   @db.Text
  detalles_musica                 String?   @db.Text
  seating_chart                   String?   @db.Text
  instrucciones_especiales        String?   @db.Text
  fecha_creacion                  DateTime  @default(now())
  fecha_actualizacion             DateTime  @default(now())
  fecha_finalizacion              DateTime?

  contratos                       contratos @relation(fields: [contrato_id], references: [id])
  clientes                        clientes? @relation(fields: [cliente_id], references: [id])
}

model solicitudes_cliente {
  id                    Int       @id @default(autoincrement())
  contrato_id           Int?
  cliente_id            Int?
  tipo_solicitud        String    @db.VarChar(50)
  invitados_adicionales Int?
  servicio_id           Int?
  cantidad_servicio     Int?
  detalles_solicitud    String?   @db.Text
  costo_adicional       Decimal?  @db.Decimal(10, 2)
  estado                String    @default("pendiente") @db.VarChar(50)
  motivo_rechazo        String?   @db.Text
  fecha_solicitud       DateTime  @default(now())
  fecha_respuesta       DateTime?
  respondido_por        Int?

  contratos             contratos? @relation(fields: [contrato_id], references: [id])
  clientes              clientes? @relation(fields: [cliente_id], references: [id])
  servicios             servicios? @relation(fields: [servicio_id], references: [id])
  vendedores            vendedores? @relation(fields: [respondido_por], references: [id])
}

model mensajes {
  id                  Int       @id @default(autoincrement())
  contrato_id         Int?
  remitente_tipo      String    @db.VarChar(50)
  remitente_id        Int
  destinatario_tipo   String    @db.VarChar(50)
  destinatario_id     Int
  mensaje             String    @db.Text
  leido               Boolean   @default(false)
  fecha_envio         DateTime  @default(now())
  fecha_lectura       DateTime?

  contratos           contratos? @relation(fields: [contrato_id], references: [id])
}

model configuracion_sistema {
  id                    Int       @id @default(autoincrement())
  clave                 String    @unique @db.VarChar(100)
  valor                 String    @db.Text
  tipo                  String?   @db.VarChar(50)
  descripcion           String?   @db.Text
  fecha_actualizacion   DateTime  @default(now())
}

model historial_cambios_precios {
  id                Int       @id @default(autoincrement())
  oferta_id         Int?
  contrato_id       Int?
  tipo_entidad      String?   @db.VarChar(50)
  entidad_id        Int?
  precio_original   Decimal   @db.Decimal(10, 2)
  precio_nuevo      Decimal   @db.Decimal(10, 2)
  motivo            String?   @db.Text
  modificado_por    Int?
  fecha_cambio      DateTime  @default(now())

  ofertas           ofertas? @relation(fields: [oferta_id], references: [id])
  contratos         contratos? @relation(fields: [contrato_id], references: [id])
  vendedores        vendedores? @relation(fields: [modificado_por], references: [id])
}

model versiones_contratos_pdf {
  id                  Int       @id @default(autoincrement())
  contrato_id         Int
  version_numero      Int
  total_contrato      Decimal   @db.Decimal(10, 2)
  cantidad_invitados  Int?
  motivo_cambio       String?   @db.Text
  cambios_detalle     Json?
  pdf_contenido       Bytes?
  generado_por        Int?
  fecha_generacion    DateTime  @default(now())

  contratos           contratos @relation(fields: [contrato_id], references: [id], onDelete: Cascade)
  vendedores          vendedores? @relation(fields: [generado_por], references: [id])

  @@unique([contrato_id, version_numero])
}

model mesas {
  id                    Int       @id @default(autoincrement())
  contrato_id           Int
  numero_mesa           Int
  nombre_mesa           String?   @db.VarChar(100)
  capacidad             Int       @default(10)
  forma                 String    @default("redonda") @db.VarChar(50)
  notas                 String?   @db.Text
  posicion_x            Decimal?  @db.Decimal(10, 2)
  posicion_y            Decimal?  @db.Decimal(10, 2)
  fecha_creacion        DateTime  @default(now())
  fecha_actualizacion   DateTime  @default(now())

  contratos             contratos @relation(fields: [contrato_id], references: [id], onDelete: Cascade)
  invitados             invitados[]

  @@unique([contrato_id, numero_mesa])
}

model invitados {
  id                        Int       @id @default(autoincrement())
  contrato_id               Int
  nombre_completo           String    @db.VarChar(255)
  email                     String?   @db.VarChar(255)
  telefono                  String?   @db.VarChar(20)
  tipo                      String    @default("adulto") @db.VarChar(50)
  mesa_id                   Int?
  confirmado                Boolean   @default(false)
  asistira                  Boolean?
  restricciones_alimentarias String?   @db.Text
  notas                     String?   @db.Text
  fecha_creacion            DateTime  @default(now())
  fecha_actualizacion       DateTime  @default(now())

  contratos                 contratos @relation(fields: [contrato_id], references: [id], onDelete: Cascade)
  mesas                     mesas? @relation(fields: [mesa_id], references: [id], onDelete: SetNull)
}

model playlist_canciones {
  id                  Int       @id @default(autoincrement())
  contrato_id         Int
  titulo              String    @db.VarChar(255)
  artista             String?   @db.VarChar(255)
  genero              String?   @db.VarChar(100)
  categoria           String    @default("favorita") @db.VarChar(50)
  notas               String?   @db.Text
  orden               Int?
  reproducida         Boolean   @default(false)
  agregado_por        String    @default("cliente") @db.VarChar(50)
  fecha_creacion      DateTime  @default(now())
  fecha_actualizacion DateTime  @default(now())

  contratos           contratos @relation(fields: [contrato_id], references: [id], onDelete: Cascade)
}

model ajustes_evento {
  id                        Int       @id @default(autoincrement())
  contrato_id               Int       @unique
  
  sabor_torta               String?   @db.VarChar(100)
  tamano_torta              String?   @db.VarChar(50)
  tipo_relleno              String?   @db.VarChar(100)
  diseno_torta              String?   @db.Text
  notas_torta               String?   @db.Text
  
  estilo_decoracion         String?   @db.VarChar(100)
  colores_principales       String?   @db.Text
  flores_preferidas         String?   @db.VarChar(255)
  tematica                  String?   @db.VarChar(100)
  notas_decoracion          String?   @db.Text
  
  tipo_servicio             String?   @db.VarChar(50)
  entrada                   String?   @db.VarChar(255)
  plato_principal           String?   @db.VarChar(255)
  acompanamientos           String?   @db.Text
  opciones_vegetarianas     String?   @db.Text
  opciones_veganas          String?   @db.Text
  restricciones_alimentarias String?   @db.Text
  bebidas_incluidas         String?   @db.Text
  notas_menu                String?   @db.Text
  
  musica_ceremonial         String?   @db.VarChar(255)
  primer_baile              String?   @db.VarChar(255)
  baile_padre_hija          String?   @db.VarChar(255)
  baile_madre_hijo          String?   @db.VarChar(255)
  hora_show                 String?   @db.VarChar(50)
  actividades_especiales    String?   @db.Text
  notas_entretenimiento     String?   @db.Text
  
  momentos_especiales       String?   @db.Text
  poses_especificas         String?   @db.Text
  ubicaciones_fotos         String?   @db.Text
  notas_fotografia          String?   @db.Text
  
  invitado_honor            String?   @db.VarChar(255)
  brindis_especial          String?   @db.VarChar(255)
  sorpresas_planeadas       String?   @db.Text
  solicitudes_especiales    String?   @db.Text
  
  porcentaje_completado     Int       @default(0)
  fecha_creacion            DateTime  @default(now())
  fecha_actualizacion       DateTime  @default(now())

  contratos                 contratos @relation(fields: [contrato_id], references: [id], onDelete: Cascade)
}

